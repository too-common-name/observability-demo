<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Observability Demo</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2em;
            background: #f4f4f4;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 2em;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .task {
            border: 1px solid #ccc;
            padding: 1.5em;
            margin-bottom: 1em;
            border-radius: 8px;
        }

        .danger-zone {
            border: 2px solid #d9534f;
            background-color: #fff0f0;
        }

        input {
            width: calc(100% - 120px);
            padding: 8px;
            margin-right: 10px;
        }

        button {
            padding: 8px 12px;
            cursor: pointer;
        }

        button.danger {
            background-color: #d9534f;
            color: white;
            border: none;
            border-radius: 4px;
        }

        button.reset {
            background-color: #f0ad4e;
            color: white;
            border: none;
            border-radius: 4px;
        }

        pre {
            background: #eee;
            padding: 1em;
            border-radius: 4px;
            overflow-wrap: break-word;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Observability Demo</h1>
        <p>Frontend: Spring Boot on Tomcat VM | Backend: Quarkus</p>

        <div class="task">
            <h2>Task 1: Palindrome Check</h2>
            <form id="palindrome-form">
                <input type="text" id="palindrome-input" value="racecar">
                <button type="submit">Check</button>
            </form>
            <pre id="palindrome-result"></pre>
        </div>

        <div class="task">
            <h2>Task 2: Sentiment Analysis (Remote)</h2>
            <form id="analyze-form">
                <input type="text" id="analyze-input" value="This demo is amazing!">
                <button type="submit">Analyze</button>
            </form>
            <pre id="analyze-result"></pre>
        </div>

        <div class="task danger-zone">
            <h2>‚ö†Ô∏è Task 3: Chaos Engineering</h2>
            <p>Force specific failure modes on the backend to test Alerting and Correlation.</p>

            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <button class="danger" onclick="triggerStress('memory')">üî• Eat Memory (100MB)</button>
                <button class="danger" onclick="triggerStress('cpu')">üî• Burn CPU (10s)</button>
                <button class="reset" onclick="triggerReset()">‚ôªÔ∏è Reset Backend</button>
            </div>
            <pre id="stress-result">Waiting for chaos...</pre>
        </div>
    </div>

    <script>
        // ... (Existing handlers for palindrome and analyze) ...
        document.getElementById('palindrome-form').onsubmit = async (e) => {
            // ... keep existing code ...
            e.preventDefault();
            const res = await fetch('/palindrome', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ data: document.getElementById('palindrome-input').value })
            });
            document.getElementById('palindrome-result').innerText = await res.text();
        };

        document.getElementById('analyze-form').onsubmit = async (e) => {
            // ... keep existing code ...
            e.preventDefault();
            const res = await fetch('/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ data: document.getElementById('analyze-input').value })
            });
            const text = await res.text();
            document.getElementById('analyze-result').innerText = `[HTTP ${res.status}]\n${text}`;
        };

        // New Handlers for Stress
        async function triggerStress(type) {
            const resultEl = document.getElementById('stress-result');
            resultEl.innerText = `Triggering ${type} stress...`;

            try {
                const res = await fetch(`/stress/${type}`, { method: 'POST' });
                const text = await res.text();
                resultEl.innerText = `[HTTP ${res.status}] ${text}`;
            } catch (err) {
                resultEl.innerText = "Error triggering stress: " + err;
            }
        }

        async function triggerReset() {
            const resultEl = document.getElementById('stress-result');
            resultEl.innerText = "Resetting backend...";
            await fetch('/reset', { method: 'POST' });
            resultEl.innerText = "Backend reset command sent.";
        }
    </script>
</body>

</html>